<!DOCTYPE html>
<html>
<head>
    <title>Player Info and their Main Class</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src='./bundle.js'></script>
<style>
    .topnav {
    overflow: hidden;
    background-color: #734d26;
  }
  .topnav a {
    float: right;
    color: #dfbe9f;
    text-align: center;
    padding: 14px 13px;
    text-decoration: none;
    font-size: 20px;
    transition: background-color 0.5s;
  }
  .title  {
    font-weight: bolder;
    margin: 0px;
    float: left;
    color: #dfbe9f;
    padding-left:14px;
    padding-top:14px;
    padding-bottom:14px;
    font-size: 20px;
  }
  .topnav img {
    float: left;
    margin-top: 4px;
    margin-left: 10px;
    width:40px;
    height:40px;
  }
  .topnav a:hover {
    background-color: #cc9766;
  }
  .topnav a.active {
    background-color: #996433;
    color: #dfbe9f;
  }
    
  body {
    background-image: linear-gradient(to right, rgba(0, 0, 0, 0.5), transparent, 
    transparent, rgba(0, 0, 0, 0.5)), url('tf2background.jpg');
    background-attachment: fixed;
    background-size: cover;
    background-repeat: no-repeat;
    margin: 0;
    font-family: Arial, Helvetica, sans-serif;

  
  }
  .container{
    display: inline-block;
    padding: 10px 17px;
    border-radius: 20px;
    text-decoration: none;
    position: relative;
    left: 150px;
    top: 20px;
    background-color:#d2cdc8;
    box-shadow: 0px 0px 12px 3px rgba(139,65,22,0.43);
    overflow: auto;
    max-height: 670px;
  }
  .container tbody{
    overflow-y: auto;
    scrollbar-width: thin; /* Width of the scrollbar */
  scrollbar-color: transparent transparent; /* Color of the thumb and track */
}

.container::-webkit-scrollbar {
  width: 0;
  background-color: transparent;
}

.crud {
  display: inline-block;
  padding: 10px 17px;
  border-radius: 20px;
  text-decoration: none;
  position: relative;
  left: 150px;
  top:0px;
  background-color: #996433;
  transition: background-color 0.5s ease;
}

  .crud a{
    float: left;
    color: #dfbe9f;
    text-align: center;
    
    font-size: 20px;
    text-decoration:none;
  }

  .crud:hover {
    background-color: #cc9766;
  }
  
</style>
<link rel="shortcut icon" href="tf2icon.ico">
</head>
<body>
    <div class="topnav" width="100%">
        <a href="authentication.html">Log In</a>
        <a href="Weberino-Contact.html">Contact Us</a>
        <a href="Weberino-About.html">About</a>
        <a href="Weberino-Gallery.html">Gallery</a>
        <a href="Weberino-Advocacy.html">Advocacy</a>
        <a  href="index.html">Home</a>
        <p class="title">Weberino</p>
        <img src="tf2logo.png" alt="Logo">
        
      </div>
 
    <div class="container">
        <h2>TF2 Player Info and Main Class</h2>
        <button class="btn btn-secondary" data-toggle="modal" data-target="#addModal">Add Row</button>
        <!--<button class="btn btn-secondary crudSaveBtn" id="crudSaveBtn">Submit Info</button>-->
        <table class="table mt-4">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Username</th>
                    <th>Hours Played</th>
                    <th>Class Main</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="table-body">
                <!-- Table rows will be dynamically added here -->
                <tr>
                    <td colspan="5">Loading data...</td>
                  </tr>
            </tbody>
        </table>

        <!-- Add Modal -->
        <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="addModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addModalLabel">Add Row</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="add-name">Username:</label>
                            <input required type="text" class="form-control" id="add-name" required>
                        </div>
                        <div class="form-group">
                            <label for="add-hour">Hours Played:</label>
                            <input type="number" step="0.01" class="form-control" id="hours-played" required>
                        </div>
<!-- Dropdown component -->
<div class="dropdown">
    <label for="dropdown">Main Class</label>
    <select id="dropdown" class="form-select form-select-sm" aria-label=".form-select-sm example">
        <option value="Scout">Scout</option>
        <option selected value="Soldier">Soldier</option>
        <option value="Pyro">Pyro</option>
        <option value="Demoman">Demoman</option>
        <option value="Heavy">Heavy</option>
        <option value="Engineer">Engineer</option>
        <option value="Medic">Medic</option>
        <option value="Sniper">Sniper</option>
        <option value="Spy">Spy</option>
      </select>
</div>
  
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="submitData">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Modal -->
        <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editModalLabel">Edit Row</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="edit-name">Username:</label>
                            <input type="text" class="form-control" id="edit-name" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-hour">Hours Played:</label>
                            <input type="number" step="0.01" class="form-control" id="edit-hour" onInput="limitDecimals(this)" required>
                        </div>
                        <!-- Dropdown component -->
<div class="dropdown-edit">
    <label for="dropdown-edit">Main Class</label>
    <select id="dropdown-edit" class="form-select form-select-sm" aria-label=".form-select-sm example" required>
        <option value="Scout">Scout</option>
        <option value="Soldier">Soldier</option>
        <option value="Pyro">Pyro</option>
        <option value="Demoman">Demoman</option>
        <option value="Heavy">Heavy</option>
        <option value="Engineer">Engineer</option>
        <option value="Medic">Medic</option>
        <option value="Sniper">Sniper</option>
        <option value="Spy">Spy</option>
      </select>
  </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="submitChanges">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
<script>
function limitDecimals(input) {
  input.value = parseFloat(input.value).toFixed(2);
}
</script>
    <!-- JavaScript code -->

    <!--Table Functionality-->

    <!--Firebase connect-->
    <script type="module">
        // Import the functions you need from the SDKs you need
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-analytics.js";
import { getFirestore,
            limit,
            collection,
            addDoc,
            connectFirestoreEmulator,
            query, 
            getDocs,
            getDoc,
            updateDoc,
            setDoc,
            doc,
            onSnapshot,
            deleteDoc,
            orderBy } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-firestore.js";

// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyA5BJMCIAI6hoXY3hD3k-QW_NnuX5GV5Es",
  authDomain: "firstproject-68c11.firebaseapp.com",
  projectId: "firstproject-68c11",
  storageBucket: "firstproject-68c11.appspot.com",
  messagingSenderId: "649357505390",
  appId: "1:649357505390:web:7e4f5d2e10c35603c0877f",
  measurementId: "G-FH35KRD446"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
console.log(app)
const db = getFirestore(app);
const collectionRef = collection(db, "player_info");

    
    var editRowId = null;
/*MAX VALUE FOR ID*/
async function getMaxValueFromCollection() {
  const collectionRef = collection(db, 'player_info');
  const q = query(collectionRef, orderBy('player_id', 'desc'), limit(1));
  const querySnapshot = await getDocs(q);
  const maxValue = querySnapshot.docs[0].data().player_id;
  return maxValue;
}
    var rowId = await getMaxValueFromCollection();
    console.log('The maximum value is:', rowId);
    var newrowId = ++rowId;

   submitData.addEventListener('click', (e) => {
        const nameInput = document.getElementById("add-name");
        const hourInput = document.getElementById("hours-played");
        const selectInput = document.getElementById("dropdown");
        const id = newrowId;
        const name = nameInput.value;
        const hours = hourInput.value;
        const dropdown = selectInput.value;

        if (nameInput.checkValidity() && hourInput.checkValidity()) {

            writePlayerInfo(id, name, hours, dropdown);
            
            nameInput.value = "";
            hourInput.value = null;
            selectInput.value = "Soldier";
            alert("Info added");

            $('#addModal').modal('hide');
            
        } else {
// Display validation notices or handle validation errors
hourInput.reportValidity();
nameInput.reportValidity();
}
    });

    function showEditModal(docID) {
        const docRef = doc(db, "player_info", docID);
        getDoc(docRef)
        .then((doc) => {
            if (doc.exists()) {
        const data = doc.data();  
        const nameInput = document.getElementById("edit-name");
        const hourInput = document.getElementById("edit-hour");
        const selectInput = document.getElementById("dropdown-edit");

        nameInput.value = data.player_name;
            hourInput.value = data.hours_played;
            selectInput.value = data.main_class;
    
        editRowId = docID;
        

        $('#editModal').modal('show');
        
    } else {
            console.log("Document not found");
        }
    }).catch(function(error) {
        console.log("Error getting document:", error);
    });
}

   
    function saveRow(editRowId) {
        var nameInput = document.getElementById("edit-name");
        var hourInput = document.getElementById("edit-hour");
        var selectInput = document.getElementById("dropdown-edit");
        var name = nameInput.value;
        var hours = hourInput.value;
        var dropdown = selectInput.value;

        if (nameInput.checkValidity() && hourInput.checkValidity()) {
            editPlayerInfo(editRowId, name, hours, dropdown)
            nameInput.value = "";
            hourInput.value = "";
            editRowId = null;

            $('#editModal').modal('hide');
            
        } else {
            
            hourInput.reportValidity();
            nameInput.reportValidity();
        }
    }

    const handler = document.getElementById("submitChanges");
    handler.addEventListener('click', (e) => {
        const docuID = editRowId;
        saveRow(editRowId);
       
        

    });


    async function deleteRow(docID) {
        const docRef = doc(db, "player_info", docID);
        try {
        await deleteDoc(docRef);
        console.log("Document successfully deleted!");
        location.reload();
        } catch (error) {
            console.error("Error removing document:", error);
        }
    }
async function writePlayerInfo(id, name, hours, dropdown) {
  const newDoc = await addDoc(collectionRef, {
    player_id: id,
    player_name: name,
    hours_played: hours,
    main_class: dropdown
  });

console.log(`Your doc was created at ${newDoc.path}`);
console.log(`Document written with ID: ${newDoc.id}`);
location.reload();
}

async function editPlayerInfo(editRowId, name, hours, dropdown) {
    const docRef = doc(db, 'player_info', editRowId);
  try {
    await updateDoc(docRef, {
      player_name: name,
      hours_played: hours,
      main_class: dropdown
    });

    console.log(`Document with ID ${editRowId} was successfully updated.`);
    alert("Info Updated");
    location.reload();
  } catch (error) {
    console.log('Error updating document:', error);
  }
  } 
  // Fetch data from Firestore and populate the table
  const tableBody = document.getElementById("table-body");
    async function populateTable() {
  tableBody.innerHTML = ""; // Clear existing table rows
  
  try {
    
    const querySnapshot = await getDocs(query(collectionRef, orderBy('player_id', 'asc')));
    const players = [];
    querySnapshot.forEach((doc) => {
        players.push(doc.data());
      const docID = doc.id;
      const id = doc.data().player_id;
      const playersName = doc.data().player_name;
      const hoursPlayed = doc.data().hours_played;
      const mainClass = doc.data().main_class;

      var row = document.createElement("tr");

      // Create table cells for each field
      var idCell = document.createElement("td");
      idCell.textContent = id;
      row.appendChild(idCell);

      var usernameCell = document.createElement("td");
      usernameCell.textContent = playersName;
      row.appendChild(usernameCell);

      var hoursPlayedCell = document.createElement("td");
      hoursPlayedCell.textContent = hoursPlayed + " hrs";
      row.appendChild(hoursPlayedCell);

      var classMainCell = document.createElement("td");
      classMainCell.textContent = mainClass;
      row.appendChild(classMainCell);

      var actionCell = document.createElement("td");

      // Create Edit button
      var editButton = document.createElement("button");
      editButton.classList.add("btn", "btn-success");
      editButton.textContent = "Edit";
      // Add event listener for edit functionality
      editButton.addEventListener("click", () => {
        showEditModal(docID);
      });
      actionCell.appendChild(editButton);

      // Create Delete button
      var deleteButton = document.createElement("button");
      deleteButton.classList.add("btn", "btn-danger");
      deleteButton.textContent = "Delete";
      // Add event listener for delete functionality
      deleteButton.addEventListener("click", () => {
        deleteRow(docID);
      });
      actionCell.appendChild(deleteButton);

      row.appendChild(actionCell);

      // Add the row to the table body
      tableBody.appendChild(row);
    });
  } catch (error) {
    console.log("Error fetching documents: ", error);
  }
}
populateTable();




    </script>

<script>
    
</script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</body>
</html>

